// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id               String             @id @default(uuid())
  username         String             @db.VarChar(20)
  subtitle         String?            @db.VarChar(24)
  bio              String?            @db.VarChar(255)
  image            String?            @db.VarChar(255)
  VerifiedEmails   VerifiedEmail[]
  UserVerification UserVerification[]
  UserIdentity     UserIdentity[]
  Chart            Chart[]
  CoinComment      CoinComment[]
  ChartComment     ChartComment[]
  ChartVote        ChartVote[]
  CoinFavourite    CoinFavourite[]
  ChartCommentVote ChartCommentVote[]
  CoinCommentVote  CoinCommentVote[]
  UserFriends      Friend[]           @relation(name: "user")
  friends          Friend[]           @relation(name: "friends")
}

model VerifiedEmail {
  id     String @id @default(uuid())
  user   User   @relation(references: [id], fields: [userId], onDelete: Cascade)
  userId String
  email  String
}

model UserVerification {
  id             String @id @default(uuid())
  user           User   @relation(references: [id], fields: [userId], onDelete: Cascade)
  userId         String
  email          String @db.VarChar(255)
  code           String @db.VarChar(6)
  provider       String @db.VarChar(255)
  providerUserId String @db.VarChar(255)
}

model UserIdentity {
  id     String @id @default(uuid())
  user   User   @relation(references: [id], fields: [userId], onDelete: Cascade)
  userId String @db.VarChar(255)
  method String @db.VarChar(255)
  lookup String @db.VarChar(255)
}

model Friend {
  userId    String
  friendId  String
  user      User     @relation(name: "user", references: [id], fields: [userId], onDelete: Cascade)
  friend    User     @relation(name: "friends", references: [id], fields: [friendId], onDelete: Cascade)
  createdAt DateTime @default(now())
  verified  Boolean  @default(false)

  @@id([userId, friendId])
}

model Coin {
  id            String          @id @default(uuid())
  coinName      String          @db.VarChar(255)
  coinId        String          @db.VarChar(255)
  symbol        String          @db.VarChar(255)
  image         String          @db.VarChar(255)
  Chart         Chart[]
  CoinComment   CoinComment[]
  CoinFavourite CoinFavourite[]
}

model Chart {
  id               String         @id @default(uuid())
  coin             Coin           @relation(references: [id], fields: [coinId])
  coinId           String
  title            String         @db.VarChar(255)
  description      String         @db.VarChar(255)
  user             User?          @relation(references: [id], fields: [userId], onDelete: SetNull)
  userId           String?
  originalUsername String         @db.VarChar(255)
  imageThumbnail   String         @db.VarChar(255)
  imageMedium      String         @db.VarChar(255)
  imageLarge       String         @db.VarChar(255)
  ChartComment     ChartComment[]
  ChartVote        ChartVote[]
}

model ChartComment {
  id               String             @id @default(uuid())
  content          String             @db.Text
  chart            Chart              @relation(references: [id], fields: [chartId], onDelete: Cascade)
  chartId          String             @db.VarChar(255)
  userId           String
  User             User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  ChartCommentVote ChartCommentVote[]
}

model ChartVote {
  user         User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId       String
  chartId      String
  chartComment Chart  @relation(fields: [chartId], references: [id], onDelete: Cascade)
  value        Int

  @@id([userId, chartId])
}

model ChartCommentVote {
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId         String
  chartCommentId String
  chartComment   ChartComment @relation(fields: [chartCommentId], references: [id], onDelete: Cascade)
  value          Int
  CoinComment    CoinComment? @relation(fields: [coinCommentId], references: [id], onDelete: Cascade)
  coinCommentId  String?

  @@id([userId, chartCommentId])
}

model CoinCommentVote {
  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId        String
  coinCommentId String
  coinComment   CoinComment @relation(fields: [coinCommentId], references: [id], onDelete: Cascade)
  value         Int

  @@id([userId, coinCommentId])
}

model CoinComment {
  id               String             @id @default(uuid())
  content          String             @db.Text
  coin             Coin               @relation(references: [id], fields: [coinId], onDelete: Cascade)
  coinId           String             @db.VarChar(255)
  userId           String
  User             User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  CoinCommentVote  CoinCommentVote[]
  ChartCommentVote ChartCommentVote[]
}

model CoinFavourite {
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  coinId String
  coin   Coin   @relation(fields: [coinId], references: [id], onDelete: Cascade)

  @@id([userId, coinId])
}
